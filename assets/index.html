<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mafia Online</title>
  <style>
    body {
      margin: 0;
      font-family: sans-serif;
      background: url('https://raw.githubusercontent.com/MrLogin4ik/mafia-assets/main/assets/background.jpg') no-repeat center center fixed;
      background-size: cover;
      color: white;
    }
    h1 {
      text-align: center;
      font-family: 'Hippopotamus Apocalypse', sans-serif;
      font-size: 3em;
      margin-top: 0.5em;
      margin-bottom: 0.5em;
      text-shadow: 2px 2px 4px #000;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
      padding: 10px;
      max-width: 1200px;
      margin: 0 auto;
    }
    .cell {
      position: relative;
      background: rgba(0, 0, 0, 0.6);
      border: 2px solid white;
      border-radius: 10px;
      overflow: hidden;
      text-align: center;
    }
    .cell iframe, .cell img.placeholder {
      width: 100%;
      aspect-ratio: 4 / 3;
      object-fit: cover;
      display: block;
    }
    .label-top {
      position: absolute;
      top: 5px;
      left: 0;
      right: 0;
      font-size: 1em;
      font-weight: bold;
      text-shadow: 1px 1px 2px black;
    }
    .label-bottom {
      position: absolute;
      bottom: 5px;
      left: 0;
      right: 0;
      font-size: 1.1em;
      font-weight: bold;
      text-shadow: 1px 1px 2px black;
    }
    .highlighted {
      outline: 4px solid yellow;
      outline-offset: -4px;
    }
    #fullscreenBtn {
      position: fixed;
      top: 10px;
      right: 10px;
      background: rgba(0,0,0,0.7);
      color: white;
      border: none;
      font-size: 18px;
      padding: 10px;
      cursor: pointer;
      z-index: 9999;
      border-radius: 6px;
    }
  </style>
</head>
<body>
  <button id="fullscreenBtn">⛶</button>
  <h1>MAFIA ONLINE</h1>
  <div class="grid" id="grid"></div>

  <script>
    const SHEET_URL = 'https://docs.google.com/spreadsheets/d/1_nKZQWCYFjZemK4HAqgCBL0JXjGmE7kHh7NvcKX61SM/edit?usp=sharing';
    const ASSET_URL = 'https://raw.githubusercontent.com/MrLogin4ik/mafia-assets/main/assets/';

    async function fetchData() {
      const res = await fetch(SHEET_URL);
      const text = await res.text();
      const json = JSON.parse(text.substring(47).slice(0, -2));
      const rows = json.table.rows;
      const data = rows.slice(0, 12).map(row => row.c.map(cell => cell ? cell.v : ''));
      renderGrid(data);
    }

    function renderGrid(data) {
      const grid = document.getElementById('grid');
      grid.innerHTML = '';

      data.forEach(([name, number, status, marked, cam], index) => {
        const div = document.createElement('div');
        div.className = 'cell';

        // Highlighted if marked
        if (marked === '*') div.classList.add('highlighted');

        // Add camera or image
        if (status.toLowerCase() === 'убит') {
          div.innerHTML = `<img class="placeholder" src="${ASSET_URL}killed.jpg" />`;
        } else if (status.toLowerCase() === 'выгнан') {
          div.innerHTML = `<img class="placeholder" src="${ASSET_URL}voted-out.jpg" />`;
        } else if (cam) {
          div.innerHTML = `<iframe src="${cam}" frameborder="0" allow="camera; microphone" allowfullscreen></iframe>`;
        } else {
          div.innerHTML = `<img class="placeholder" src="${ASSET_URL}empty.jpg" />`;
        }

        // Labels
        const labelTop = document.createElement('div');
        labelTop.className = 'label-top';
        labelTop.textContent = number || '';
        div.appendChild(labelTop);

        const labelBottom = document.createElement('div');
        labelBottom.className = 'label-bottom';
        labelBottom.textContent = name || '';
        div.appendChild(labelBottom);

        grid.appendChild(div);
      });
    }

    setInterval(fetchData, 2000);
    fetchData();

    // Fullscreen button
    document.getElementById('fullscreenBtn').addEventListener('click', () => {
      if (!document.fullscreenElement) {
        document.documentElement.requestFullscreen();
      } else {
        document.exitFullscreen();
      }
    });
  </script>
</body>
</html>
